import{r as l,j as a,e as S}from"./index-Dm7atRpY.js";import{B as p}from"./index-BlhDO3pI.js";import{I as v}from"./input-C-A1T-iP.js";import{S as $,a as R,b as L,c as U,d as V}from"./select-D5rxK3kY.js";import{U as k}from"./Layout-B3tkA0W2.js";const w="attendance_templates_v1";function x(){try{const e=localStorage.getItem(w);return e?JSON.parse(e):[]}catch{return[]}}function D(e,o){const n=x().filter(i=>i.name!==e);n.push({name:e,data:o,createdAt:new Date().toISOString()}),localStorage.setItem(w,JSON.stringify(n))}function B(e){return x().find(o=>o.name===e)}function G(e){const o=y(e.start),n=y(e.end||new Date(e.start.getTime()+3600*1e3));return`https://www.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:e.title,dates:`${o}/${n}`,details:e.description||"",location:e.location||""}).toString()}`}function M(e){const o=N(e.start),n=N(e.end||new Date(e.start.getTime()+3600*1e3));return["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//AMSUIP//Attendance//EN","BEGIN:VEVENT",`DTSTART:${o}`,`DTEND:${n}`,`SUMMARY:${g(e.title)}`,e.description?`DESCRIPTION:${g(e.description)}`:"",e.location?`LOCATION:${g(e.location)}`:"","END:VEVENT","END:VCALENDAR"].filter(Boolean).join(`\r
`)}function P(e,o){const n=new Blob([o],{type:"text/calendar;charset=utf-8"}),i=URL.createObjectURL(n),m=document.createElement("a");m.href=i,m.download=e.endsWith(".ics")?e:`${e}.ics`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(i)}function N(e){return e.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z"}function g(e){return e.replace(/[\\,;\n]/g,o=>({"\\":"\\\\",",":"\\,",";":"\\;","\n":"\\n"})[o])}function y(e){return e.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z"}const z=({onSuccess:e,onSubmit:o,initialData:n})=>{const[i,m]=l.useState(n?.attendanceType||"class"),[u,h]=l.useState(1),[s,I]=l.useState({title:n?.title||"",program:n?.program||"",year:n?.year||"",section:n?.section||"",date:n?.date||"",timeIn:n?.timeIn||"",timeOut:n?.timeOut||""}),[f,j]=l.useState(""),[C,O]=l.useState(0),[_,Z]=l.useState(!1),[T,F]=l.useState({programs:[],years:[],sections:{}});l.useCallback(()=>{if(!s.program||!s.year)return[];const t=`${s.program}|${s.year}`;return T.sections[t]||[]},[s.program,s.year,T.sections]);const b=t=>{const d=B(t);if(!d)return;const r=d.data;I(c=>({...c,title:r.title||c.title,program:r.program||c.program,year:r.year||c.year,section:r.section||c.section,date:r.date||c.date,timeIn:r.timeIn||c.timeIn,timeOut:r.timeOut||c.timeOut})),r.attendanceType&&m(r.attendanceType),S.success(`Applied template: ${t}`)},E=()=>{const t=f||prompt("Template name?")||"";t.trim()&&(D(t.trim(),{...s,attendanceType:i}),O(d=>d+1),S.success("Template saved"))},A=()=>{if(!s.title||!s.date||!s.timeIn){S.warning("Please set title, date and start time");return}const t=new Date(`${s.date}T${s.timeIn}:00Z`),d=s.timeOut?new Date(`${s.date}T${s.timeOut}:00Z`):new Date(t.getTime()+3600*1e3),r=G({title:s.title,start:t,end:d,description:n?.description,location:n?.venue});window.open(r,"_blank");const c=M({title:s.title,start:t,end:d,description:n?.description,location:n?.venue});P(s.title.replace(/\s+/g,"_"),c)};return a.jsxs("div",{className:"w-full max-w-none mx-auto px-6 py-4",children:[a.jsxs("div",{className:"flex flex-col md:flex-row gap-2 md:gap-3 mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs($,{value:"",onValueChange:t=>b(t),children:[a.jsx(R,{className:"w-[200px]",children:a.jsx(L,{placeholder:"Load template"})}),a.jsx(U,{children:x().map(t=>a.jsx(V,{value:t.name,children:t.name},t.name+C))})]}),a.jsx(v,{placeholder:"Template name",value:f,onChange:t=>j(t.target.value),className:"w-[180px]"}),a.jsx(p,{variant:"outline",onClick:E,children:"Save Template"})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(p,{variant:"outline",onClick:A,children:"Add to Calendar (Google/ICS)"})})]}),a.jsx("div",{className:"pb-8",children:a.jsx("form",{onSubmit:handleSubmit,className:"space-y-5","aria-live":"polite",children:a.jsxs("div",{className:"md:col-span-2 pt-3 pb-4 flex gap-2 justify-center",children:[u>1&&a.jsx(p,{type:"button",variant:"outline",onClick:()=>h(t=>Math.max(1,t-1)),className:"min-w-[120px]",children:"Back"}),u<3&&a.jsx(p,{type:"button",disabled:u===1&&!canGoNextFromDetails(),onClick:()=>h(t=>Math.min(3,t+1)),className:"min-w-[160px]",children:"Next"}),u===3&&a.jsxs(p,{type:"submit",className:`${getTypeColor(i)} shadow-glow hover:opacity-90 transition-opacity min-w-[200px] min-h-[42px] text-base`,children:[a.jsx(k,{className:"w-4 h-4 mr-2"}),n?.id?"Update Session":"Create Session"]})]})})})]})};export{z as A};
