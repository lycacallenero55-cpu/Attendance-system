import{j as e,d as V,i as G,r as u,s as K}from"./index-CZr3ktf2.js";import{B as Z}from"./index-DC1ZGnvg.js";import{B as h}from"./badge-DMQS0S5c.js";import{I as Q}from"./input-CgEU1t-I.js";import{C as X,a as ee,b as te,c as se}from"./card-BaLCcYSu.js";import{T as ae,a as re,b as S,c as C}from"./tabs-CYMB4KO4.js";import{L as ne,C as F}from"./Layout-d_Uy6Fn7.js";import{t as N,c as ie,s as $,m as H,a as W,f as P}from"./format-CR8w9UPR.js";import{R as ce}from"./refresh-cw-CxnXuRLJ.js";import{S as oe}from"./search-C1M6jnsu.js";import{C as b}from"./calendar-days-CKb8DMG6.js";import{B as le}from"./book-open-NgY1Xgmv.js";import{S as de}from"./star-Bu7kUsqB.js";import{C as me}from"./clock-7AhDGuuh.js";import"./index-CLWOJdFP.js";import"./index-3K0ulQV1.js";function z(t,s){const a=N(t);return isNaN(s)?ie(t,NaN):(a.setDate(a.getDate()+s),a)}function _(t,s){const a=$(t),r=$(s);return+a==+r}function ue(t,s){const a=N(t),r=N(s);return a.getTime()>r.getTime()}function xe(t,s){const a=N(t),r=N(s);return+a<+r}function q(t,s){const r=ge(t);let i;if(r.date){const l=Ne(r.date,2);i=je(l.restDateString,l.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);const m=i.getTime();let x=0,d;if(r.time&&(x=ye(r.time),isNaN(x)))return new Date(NaN);if(r.timezone){if(d=we(r.timezone),isNaN(d))return new Date(NaN)}else{const l=new Date(m+x),f=new Date(0);return f.setFullYear(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()),f.setHours(l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds(),l.getUTCMilliseconds()),f}return new Date(m+x+d)}const k={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},fe=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,he=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,pe=/^([+-])(\d{2})(?::?(\d{2}))?$/;function ge(t){const s={},a=t.split(k.dateTimeDelimiter);let r;if(a.length>2)return s;if(/:/.test(a[0])?r=a[0]:(s.date=a[0],r=a[1],k.timeZoneDelimiter.test(s.date)&&(s.date=t.split(k.timeZoneDelimiter)[0],r=t.substr(s.date.length,t.length))),r){const i=k.timezone.exec(r);i?(s.time=r.replace(i[1],""),s.timezone=i[1]):s.time=r}return s}function Ne(t,s){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),r=t.match(a);if(!r)return{year:NaN,restDateString:""};const i=r[1]?parseInt(r[1]):null,m=r[2]?parseInt(r[2]):null;return{year:m===null?i:m*100,restDateString:t.slice((r[1]||r[2]).length)}}function je(t,s){if(s===null)return new Date(NaN);const a=t.match(fe);if(!a)return new Date(NaN);const r=!!a[4],i=g(a[1]),m=g(a[2])-1,x=g(a[3]),d=g(a[4]),l=g(a[5])-1;if(r)return Ce(s,d,l)?ve(s,d,l):new Date(NaN);{const f=new Date(0);return!Te(s,m,x)||!Se(s,i)?new Date(NaN):(f.setUTCFullYear(s,m,Math.max(i,x)),f)}}function g(t){return t?parseInt(t):1}function ye(t){const s=t.match(he);if(!s)return NaN;const a=O(s[1]),r=O(s[2]),i=O(s[3]);return be(a,r,i)?a*H+r*W+i*1e3:NaN}function O(t){return t&&parseFloat(t.replace(",","."))||0}function we(t){if(t==="Z")return 0;const s=t.match(pe);if(!s)return 0;const a=s[1]==="+"?-1:1,r=parseInt(s[2]),i=s[3]&&parseInt(s[3])||0;return _e(r,i)?a*(r*H+i*W):NaN}function ve(t,s,a){const r=new Date(0);r.setUTCFullYear(t,0,4);const i=r.getUTCDay()||7,m=(s-1)*7+a+1-i;return r.setUTCDate(r.getUTCDate()+m),r}const De=[31,null,31,30,31,30,31,31,30,31,30,31];function J(t){return t%400===0||t%4===0&&t%100!==0}function Te(t,s,a){return s>=0&&s<=11&&a>=1&&a<=(De[s]||(J(t)?29:28))}function Se(t,s){return s>=1&&s<=(J(t)?366:365)}function Ce(t,s,a){return s>=1&&s<=53&&a>=0&&a<=6}function be(t,s,a){return t===24?s===0&&a===0:a>=0&&a<60&&s>=0&&s<60&&t>=0&&t<25}function _e(t,s){return s>=0&&s<=59}const ke=t=>P(q(t),"MMMM d, yyyy"),Y=t=>t?P(q(`2000-01-01T${t}`),"h:mm a"):"--:--",Ie=()=>{const t=V();G();const[s,a]=u.useState([]),[r,i]=u.useState(!0),[m,x]=u.useState(null),[d,l]=u.useState(""),[f]=u.useState(void 0),[Ue,A]=u.useState(1),[U,Le]=u.useState("all"),[j,M]=u.useState([]),L=u.useCallback(async()=>{try{i(!0),x(null);let n=K.from("sessions").select("*",{count:"exact"});U!=="all"&&(n=n.eq("type",U)),n=n.order("date",{ascending:!0}).order("time_in",{ascending:!0});const{data:c,error:B,count:Oe}=await n;if(B)throw B;const E=(c||[]).map(o=>({id:o.id,created_at:o.created_at||new Date().toISOString(),updated_at:o.updated_at||new Date().toISOString(),title:o.title||"Untitled Session",description:o.description||"",type:o.type||"class",date:o.date,time_in:o.time_in||"00:00",time_out:o.time_out||"00:00",location:o.location||"TBD",instructor:o.instructor||"TBD",capacity:o.capacity||0,program:o.program||"",year:o.year||"",section:o.section||"",attendees_count:o.attendees_count||0,enrolled_students:o.enrolled_students||[]}));return a(E),E}catch(n){const c=n instanceof Error?n.message:"Unknown error occurred";return console.error("Error details:",{message:c,name:n?.name,stack:n?.stack,date:new Date().toISOString()}),x(`Failed to load sessions: ${c}`),[]}finally{i(!1)}},[f,U,x,i,a]);u.useEffect(()=>{L()},[L]),u.useEffect(()=>{const n=s.filter(c=>!d||c.title.toLowerCase().includes(d.toLowerCase())||c.description&&c.description.toLowerCase().includes(d.toLowerCase())||c.instructor.toLowerCase().includes(d.toLowerCase())||c.location&&c.location.toLowerCase().includes(d.toLowerCase()));M(n),A(1)},[s,d,M,A]);const p=new Date,R=new Date(p);R.setHours(0,0,0,0);const y=j.filter(n=>{const c=new Date(n.date);return _(c,p)}),w=j.filter(n=>{const c=new Date(n.date);return _(c,z(p,1))}),v=j.filter(n=>{const c=new Date(n.date);return!_(c,p)&&!_(c,z(p,1))&&ue(c,p)}),D=j.filter(n=>{const c=new Date(n.date);return xe(c,R)}),T=u.useCallback(n=>{t(`/take-attendance/${n}`)},[t]);return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):m?e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Error: "}),e.jsx("span",{className:"block sm:inline",children:m})]}):e.jsxs("div",{className:"flex-1 flex flex-col space-y-4 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Take Attendance"}),e.jsx("p",{className:"text-muted-foreground",children:"Select a session to take attendance"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(Z,{variant:"outline",size:"sm",onClick:L,disabled:r,children:[e.jsx(ce,{className:`h-4 w-4 mr-2 ${r?"animate-spin":""}`}),"Refresh"]})})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 text-muted-foreground w-3.5 h-3.5"}),e.jsx(Q,{type:"search",placeholder:"Search sessions...",className:"pl-8 h-9 w-full text-sm",value:d,onChange:n=>l(n.target.value)})]})})}),e.jsxs(ae,{defaultValue:"today",className:"space-y-4",children:[e.jsxs(re,{children:[e.jsxs(S,{value:"today",className:"relative",children:["Today",y.length>0&&e.jsx(h,{className:"ml-2 h-5 w-5 rounded-full bg-primary text-primary-foreground text-xs flex items-center justify-center",children:y.length})]}),e.jsxs(S,{value:"tomorrow",className:"relative",children:["Tomorrow",w.length>0&&e.jsx(h,{className:"ml-2 h-5 w-5 rounded-full bg-primary text-primary-foreground text-xs flex items-center justify-center",children:w.length})]}),e.jsxs(S,{value:"upcoming",className:"relative",children:["Upcoming",v.length>0&&e.jsx(h,{className:"ml-2 h-5 w-5 rounded-full bg-primary text-primary-foreground text-xs flex items-center justify-center",children:v.length})]}),e.jsxs(S,{value:"past",className:"relative",children:["Past",D.length>0&&e.jsx(h,{className:"ml-2 h-5 w-5 rounded-full bg-primary text-primary-foreground text-xs flex items-center justify-center",children:D.length})]})]}),e.jsx(C,{value:"today",className:"space-y-4",children:y.length>0?e.jsx("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:y.map(n=>e.jsx(I,{session:n,onStartAttendance:T},n.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(b,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No sessions today"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"There are no sessions scheduled for today."})]})}),e.jsx(C,{value:"tomorrow",className:"space-y-4",children:w.length>0?e.jsx("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:w.map(n=>e.jsx(I,{session:n,onStartAttendance:T},n.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(b,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No sessions tomorrow"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"There are no sessions scheduled for tomorrow."})]})}),e.jsx(C,{value:"upcoming",className:"space-y-4",children:v.length>0?e.jsx("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:v.map(n=>e.jsx(I,{session:n,onStartAttendance:T},n.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(b,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No upcoming sessions"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"There are no upcoming sessions scheduled."})]})}),e.jsx(C,{value:"past",className:"space-y-4",children:D.length>0?e.jsx("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:D.map(n=>e.jsx(I,{session:n,onStartAttendance:T},n.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(b,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No past sessions"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"There are no past sessions to display."})]})})]})]})},I=({session:t,onStartAttendance:s})=>e.jsxs(X,{className:"relative overflow-hidden shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"absolute top-2 right-2",children:[t.type==="class"&&e.jsx(h,{className:"bg-primary/10 text-primary border-primary/20 text-xs",children:"Class"}),t.type==="event"&&e.jsx(h,{className:"bg-accent/10 text-accent border-accent/20 text-xs",children:"Event"}),t.type==="other"&&e.jsx(h,{className:"bg-education-navy/10 text-education-navy border-education-navy/20 text-xs",children:"Activity"})]}),e.jsxs(ee,{className:"p-3 pb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.type==="class"&&e.jsx(le,{className:"h-4 w-4 text-primary"}),t.type==="event"&&e.jsx(F,{className:"h-4 w-4 text-accent"}),t.type==="other"&&e.jsx(de,{className:"h-4 w-4 text-education-navy"}),e.jsx(te,{className:"text-base",children:t.title})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-0.5",children:[t.program," • ",t.year," ",t.section&&`• ${t.section}`]})]}),e.jsxs(se,{className:"p-3 pt-0",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-muted-foreground",children:[e.jsx(F,{className:"h-3.5 w-3.5 mr-1.5"}),e.jsx("span",{children:ke(t.date)})]}),e.jsxs("div",{className:"flex items-center text-muted-foreground",children:[e.jsx(me,{className:"h-3.5 w-3.5 mr-1.5"}),e.jsxs("span",{children:[Y(t.time_in)," - ",Y(t.time_out)]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-muted-foreground text-ellipsis overflow-hidden",children:[e.jsx("span",{className:"font-medium",children:"Instr:"})," ",t.instructor]}),e.jsxs("div",{className:"text-muted-foreground text-ellipsis overflow-hidden",children:[e.jsx("span",{className:"font-medium",children:"Loc:"})," ",t.location||"TBD"]})]})]}),e.jsx(Z,{size:"sm",className:"w-full mt-3 text-xs h-8 bg-teal-300 text-teal-900 hover:bg-teal-200 shadow-glow hover:shadow-elegant transition-all duration-200",onClick:()=>s(t.id),children:"Start Attendance"})]})]}),Ge=()=>e.jsx(ne,{children:e.jsx(Ie,{})});export{Ge as default};
