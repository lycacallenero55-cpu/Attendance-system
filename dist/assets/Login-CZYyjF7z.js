import{r as l,u as O,d as J,j as e,e as t,s as w}from"./index-CZr3ktf2.js";import{B as x}from"./index-DC1ZGnvg.js";import{I as o}from"./input-CgEU1t-I.js";import{L as i}from"./label-rm78Ai_s.js";import{C as W,a as Y,b as $,d as G,c as S,e as b}from"./card-BaLCcYSu.js";import{S as C,a as F,b as E,c as I,d as c}from"./select-ryfx1BI1.js";import{T as K,a as Q,b as q,c as L}from"./tabs-CYMB4KO4.js";import{E as P}from"./eye-off-0C-8sbS5.js";import{E as T}from"./eye-Dpc4bY8u.js";import"./index-3K0ulQV1.js";import"./index-CLWOJdFP.js";function oe(){const[d,j]=l.useState(""),[u,f]=l.useState(""),[v,R]=l.useState(""),[y,A]=l.useState(""),[p,U]=l.useState(""),[g,k]=l.useState(""),[a,N]=l.useState(!1),[m,h]=l.useState(!1),{signIn:D,signUp:V}=O(),H=J(),z=async s=>{if(s.preventDefault(),!g){t.error("Please select a role");return}h(!0);try{const{error:r}=await D(d,u);if(r)throw r;const{data:n,error:M}=await w.from("profiles").select("role").eq("email",d).single();if(M){t.error("Failed to verify user role");return}if(n.role!==g){t.error(`Invalid role selected. Your account role is: ${n.role}`),await w.auth.signOut();return}t.success("Successfully logged in!"),H("/")}catch(r){console.error("Error signing in:",r);const n=r instanceof Error?r.message:"Failed to sign in. Please check your credentials.";t.error(n)}finally{h(!1)}},B=async s=>{if(s.preventDefault(),!p){t.error("Please select a role");return}h(!0);try{const{error:r}=await V(d,u,v,y,p);if(r)throw r;t.success("Account created successfully! Please wait for admin approval.")}catch(r){console.error("Error signing up:",r);const n=r instanceof Error?r.message:"Failed to create account.";t.error(n)}finally{h(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:e.jsxs(W,{className:"w-full max-w-md",children:[e.jsxs(Y,{className:"space-y-1",children:[e.jsx($,{className:"text-2xl font-bold text-center",children:"Welcome"}),e.jsx(G,{className:"text-center",children:"Sign in to your account or create a new one"})]}),e.jsxs(K,{defaultValue:"signin",className:"w-full",children:[e.jsxs(Q,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsx(q,{value:"signin",children:"Sign In"}),e.jsx(q,{value:"signup",children:"Sign Up"})]}),e.jsx(L,{value:"signin",className:"px-0",children:e.jsxs("form",{onSubmit:z,children:[e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"signin-email",children:"Email"}),e.jsx(o,{id:"signin-email",type:"email",placeholder:"m@example.com",value:d,onChange:s=>j(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{htmlFor:"signin-password",children:"Password"}),e.jsx("a",{href:"#",className:"text-sm text-primary hover:underline",children:"Forgot password?"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(o,{id:"signin-password",type:a?"text":"password",value:u,onChange:s=>f(s.target.value),required:!0,className:"pr-10"}),e.jsxs(x,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>N(!a),children:[a?e.jsx(P,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(T,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"sr-only",children:a?"Hide password":"Show password"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"login-role",children:"Role"}),e.jsxs(C,{value:g,onValueChange:k,required:!0,children:[e.jsx(F,{children:e.jsx(E,{placeholder:"Select your role"})}),e.jsxs(I,{children:[e.jsx(c,{value:"admin",children:"Admin"}),e.jsx(c,{value:"instructor",children:"Instructor"}),e.jsx(c,{value:"user",children:"User"})]})]})]})]}),e.jsx(b,{children:e.jsx(x,{type:"submit",className:"w-full",disabled:m,children:m?"Signing in...":"Sign In"})})]})}),e.jsx(L,{value:"signup",className:"px-0",children:e.jsxs("form",{onSubmit:B,children:[e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"first-name",children:"First Name"}),e.jsx(o,{id:"first-name",type:"text",placeholder:"John",value:v,onChange:s=>R(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"last-name",children:"Last Name"}),e.jsx(o,{id:"last-name",type:"text",placeholder:"Doe",value:y,onChange:s=>A(s.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"signup-email",children:"Email"}),e.jsx(o,{id:"signup-email",type:"email",placeholder:"m@example.com",value:d,onChange:s=>j(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"role",children:"Role"}),e.jsxs(C,{value:p,onValueChange:U,required:!0,children:[e.jsx(F,{children:e.jsx(E,{placeholder:"Select your role"})}),e.jsxs(I,{children:[e.jsx(c,{value:"admin",children:"Admin"}),e.jsx(c,{value:"instructor",children:"Instructor"}),e.jsx(c,{value:"user",children:"User"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"signup-password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(o,{id:"signup-password",type:a?"text":"password",value:u,onChange:s=>f(s.target.value),required:!0,className:"pr-10"}),e.jsxs(x,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>N(!a),children:[a?e.jsx(P,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(T,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"sr-only",children:a?"Hide password":"Show password"})]})]})]})]}),e.jsx(b,{children:e.jsx(x,{type:"submit",className:"w-full",disabled:m,children:m?"Creating account...":"Create Account"})})]})})]})]})})}export{oe as default};
