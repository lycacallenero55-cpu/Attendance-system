import{c as X,r as c,u as q,j as e,s as u,e as o}from"./index-Dm7atRpY.js";import{B as v}from"./index-BlhDO3pI.js";import{I as D}from"./input-C-A1T-iP.js";import{B as L}from"./badge-BaVj31nL.js";import{C as y,a as b,b as N,d as w,c as C}from"./card-B5UIdz6X.js";import{T as W,a as Y,b as S,c as i,d as G,e as d}from"./table-C8d3PbJy.js";import{S as A,a as _,b as k,c as U,d as t}from"./select-D5rxK3kY.js";import{L as T,i as J}from"./Layout-B3tkA0W2.js";import{P as K}from"./PageWrapper-ZHPx4_ad.js";import{S as O}from"./search-BhyMOFM_.js";import{C as Q}from"./circle-check-CtXxrWZL.js";import{C as R}from"./circle-x-BjBbQ_Wb.js";import{C as Z}from"./clock-DUcCDY6H.js";import{f as ee}from"./format-CR8w9UPR.js";import"./index-o3oZkxKP.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=X("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),re=({role:a})=>{const l={admin:"bg-primary/10 text-primary",instructor:"bg-secondary/10 text-secondary-foreground",user:"bg-muted text-muted-foreground"};return e.jsx(L,{className:l[a],children:a.charAt(0).toUpperCase()+a.slice(1)})},ae=({status:a})=>{const l={active:{className:"bg-green-100 text-green-800",icon:e.jsx(J,{className:"w-3 h-3 mr-1"})},inactive:{className:"bg-gray-100 text-gray-600",icon:e.jsx(se,{className:"w-3 h-3 mr-1"})},pending:{className:"bg-yellow-100 text-yellow-800",icon:e.jsx(Z,{className:"w-3 h-3 mr-1"})},suspended:{className:"bg-red-100 text-red-800",icon:e.jsx(R,{className:"w-3 h-3 mr-1"})}};return e.jsx(L,{className:l[a].className,children:e.jsxs("div",{className:"flex items-center",children:[l[a].icon,e.jsx("span",{className:"capitalize",children:a})]})})},ve=()=>{const[a,l]=c.useState(""),[x,P]=c.useState("all"),[h,B]=c.useState("all"),[E,g]=c.useState([]),[I,j]=c.useState(!0),[m,M]=c.useState(null),{user:n}=q(),F=async()=>{if(n)try{const{data:s,error:r}=await u.from("profiles").select("*").eq("id",n.id).single();if(r)throw r;M(s),s?.role==="admin"?p():(g([s]),j(!1))}catch(s){console.error("Error loading user profile:",s),o.error("Failed to load profile"),j(!1)}},p=async()=>{try{const{data:s,error:r}=await u.from("profiles").select("*").order("created_at",{ascending:!1});if(r)throw r;g(s||[])}catch(s){console.error("Error loading profiles:",s),o.error("Failed to load accounts")}finally{j(!1)}};c.useEffect(()=>{n&&F()},[n]);const z=async s=>{try{const{error:r}=await u.rpc("approve_user",{user_id:s,approver_id:n?.id});if(r)throw r;o.success("User approved successfully"),m?.role==="admin"&&p()}catch(r){console.error("Error approving user:",r),o.error("Failed to approve user")}},H=async s=>{try{const{error:r}=await u.rpc("reject_user",{user_id:s,rejector_id:n?.id});if(r)throw r;o.success("User rejected successfully"),m?.role==="admin"&&p()}catch(r){console.error("Error rejecting user:",r),o.error("Failed to reject user")}},f=E.filter(s=>{const r=`${s.first_name} ${s.last_name}`.toLowerCase().includes(a.toLowerCase())||s.email.toLowerCase().includes(a.toLowerCase()),$=x==="all"||s.role===x,V=h==="all"||s.status===h;return r&&$&&V});return I?e.jsx(T,{children:e.jsx("div",{className:"container mx-auto p-4",children:e.jsx("div",{className:"text-center",children:"Loading accounts..."})})}):e.jsx(T,{children:e.jsx(K,{skeletonType:"table",children:e.jsxs("div",{className:"px-6 py-4 space-y-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Account Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage user accounts and access permissions"})]})}),m?.role==="admin"&&e.jsx("div",{className:"flex items-center justify-between gap-4 p-0",children:e.jsxs("div",{className:"flex flex-1 items-center gap-3",children:[e.jsxs("div",{className:"relative min-w-[280px] max-w-[400px]",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(D,{type:"search",placeholder:"Search accounts...",className:"pl-10 h-10 w-full text-sm bg-background border-border focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all duration-200",value:a,onChange:s=>l(s.target.value)})]}),e.jsxs(A,{value:x,onValueChange:P,children:[e.jsx(_,{className:"h-10 min-w-[140px] border-border hover:bg-muted/80 transition-colors duration-200",children:e.jsx(k,{placeholder:"Filter by role"})}),e.jsxs(U,{className:"bg-popover border-border shadow-elegant",children:[e.jsx(t,{value:"all",children:"All Roles"}),e.jsx(t,{value:"admin",children:"Admin"}),e.jsx(t,{value:"instructor",children:"Instructor"}),e.jsx(t,{value:"user",children:"User"})]})]}),e.jsxs(A,{value:h,onValueChange:B,children:[e.jsx(_,{className:"h-10 min-w-[140px] border-border hover:bg-muted/80 transition-colors duration-200",children:e.jsx(k,{placeholder:"Filter by status"})}),e.jsxs(U,{className:"bg-popover border-border shadow-elegant",children:[e.jsx(t,{value:"all",children:"All Statuses"}),e.jsx(t,{value:"pending",children:"Pending"}),e.jsx(t,{value:"active",children:"Active"}),e.jsx(t,{value:"inactive",children:"Inactive"}),e.jsx(t,{value:"suspended",children:"Suspended"})]})]})]})}),m?.role==="admin"?e.jsxs(y,{children:[e.jsxs(b,{children:[e.jsx(N,{children:"User Accounts"}),e.jsxs(w,{children:[f.length," ",f.length===1?"account":"accounts"," found"]})]}),e.jsx(C,{children:e.jsx("div",{className:"border rounded-lg",children:e.jsxs(W,{children:[e.jsx(Y,{children:e.jsxs(S,{children:[e.jsx(i,{children:"User"}),e.jsx(i,{children:"Role"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Created"}),e.jsx(i,{className:"text-right",children:"Actions"})]})}),e.jsx(G,{children:f.map(s=>e.jsxs(S,{children:[e.jsx(d,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.first_name&&s.last_name?`${s.first_name} ${s.last_name}`:s.email.split("@")[0]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email})]})}),e.jsx(d,{children:e.jsx(re,{role:s.role})}),e.jsx(d,{children:e.jsx(ae,{status:s.status})}),e.jsx(d,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:ee(new Date(s.created_at),"MMM d, yyyy")})}),e.jsx(d,{className:"text-right",children:s.status==="pending"&&e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(v,{size:"sm",onClick:()=>z(s.id),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(v,{size:"sm",variant:"outline",onClick:()=>H(s.id),className:"text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),"Reject"]})]})})]},s.id))})]})})})]}):e.jsxs(y,{children:[e.jsxs(b,{children:[e.jsx(N,{children:"Account Access"}),e.jsx(w,{children:"You can only view and manage your own account information."})]}),e.jsx(C,{children:e.jsx("p",{className:"text-muted-foreground",children:'Use the "My Account" button above to view and edit your profile information.'})})]})]})})})};export{ve as default};
