import{c as ze,r as s,o as Y,P as O,t as he,j as e,k as $,v as nt,m as It,w as At,n as Dt,x as ot,p as fe,A as lt,q as it,y as Mt,z as Ot,D as Ft,C as $t,B as Tt,f as Lt,s as A,X as zt}from"./index-Dm7atRpY.js";import{C as Be,a as Vt,b as qt,c as Ut}from"./card-B5UIdz6X.js";import{h as Kt,R as Bt,u as Gt,F as Ht,B as _}from"./index-BlhDO3pI.js";import{B as Ne}from"./badge-BaVj31nL.js";import{I as Ge}from"./input-C-A1T-iP.js";import{S as Zt,a as Xt,b as Wt,c as Yt,d as ye,C as Se}from"./select-D5rxK3kY.js";import{R as Jt,P as Qt,O as er,j as tr,L as rr,C as He,F as Ze,D as Ce,b as Ee,c as _e,d as ke,e as Xe,g as We}from"./Layout-B3tkA0W2.js";import{S as ct}from"./search-BhyMOFM_.js";import{L}from"./label-CaWY0KgR.js";import{P as Ye,T as sr}from"./trash-2-BOOJ4Yrf.js";import{C as Je}from"./clock-DUcCDY6H.js";import{E as ar}from"./eye-D-W7VtRK.js";import{S as nr}from"./square-pen-ZMV5VQ6g.js";import{C as or}from"./circle-alert-zayn5guE.js";import{C as lr}from"./circle-check-CtXxrWZL.js";import{f as W}from"./format-CR8w9UPR.js";import"./index-o3oZkxKP.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=ze("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=ze("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cr=ze("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);var et=1,dr=.9,ur=.8,mr=.17,Re=.1,Pe=.999,pr=.9999,fr=.99,hr=/[\\\/_+.#"@\[\(\{&]/,xr=/[\\\/_+.#"@\[\(\{&]/g,gr=/[\s-]/,dt=/[\s-]/g;function Ae(t,a,r,u,l,i,d){if(i===a.length)return l===t.length?et:fr;var f=`${l},${i}`;if(d[f]!==void 0)return d[f];for(var y=u.charAt(i),c=r.indexOf(y,l),x=0,m,j,N,D;c>=0;)m=Ae(t,a,r,u,c+1,i+1,d),m>x&&(c===l?m*=et:hr.test(t.charAt(c-1))?(m*=ur,N=t.slice(l,c-1).match(xr),N&&l>0&&(m*=Math.pow(Pe,N.length))):gr.test(t.charAt(c-1))?(m*=dr,D=t.slice(l,c-1).match(dt),D&&l>0&&(m*=Math.pow(Pe,D.length))):(m*=mr,l>0&&(m*=Math.pow(Pe,c-l))),t.charAt(c)!==a.charAt(i)&&(m*=pr)),(m<Re&&r.charAt(c-1)===u.charAt(i+1)||u.charAt(i+1)===u.charAt(i)&&r.charAt(c-1)!==u.charAt(i))&&(j=Ae(t,a,r,u,c+1,i+2,d),j*Re>m&&(m=j*Re)),m>x&&(x=m),c=r.indexOf(y,c+1);return d[f]=x,x}function tt(t){return t.toLowerCase().replace(dt," ")}function vr(t,a,r){return t=r&&r.length>0?`${t+" "+r.join(" ")}`:t,Ae(t,a,tt(t),tt(a),0,0,{})}var pe='[cmdk-group=""]',Ie='[cmdk-group-items=""]',yr='[cmdk-group-heading=""]',ut='[cmdk-item=""]',rt=`${ut}:not([aria-disabled="true"])`,De="cmdk-item-select",ae="data-value",wr=(t,a,r)=>vr(t,a,r),mt=s.createContext(void 0),xe=()=>s.useContext(mt),pt=s.createContext(void 0),Ve=()=>s.useContext(pt),ft=s.createContext(void 0),ht=s.forwardRef((t,a)=>{let r=ne(()=>{var n,h;return{search:"",value:(h=(n=t.value)!=null?n:t.defaultValue)!=null?h:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),u=ne(()=>new Set),l=ne(()=>new Map),i=ne(()=>new Map),d=ne(()=>new Set),f=xt(t),{label:y,children:c,value:x,onValueChange:m,filter:j,shouldFilter:N,loop:D,disablePointerSelection:q=!1,vimBindings:F=!0,...U}=t,Q=Y(),le=Y(),ee=Y(),k=s.useRef(null),S=Ir();J(()=>{if(x!==void 0){let n=x.trim();r.current.value=n,C.emit()}},[x]),J(()=>{S(6,G)},[]);let C=s.useMemo(()=>({subscribe:n=>(d.current.add(n),()=>d.current.delete(n)),snapshot:()=>r.current,setState:(n,h,g)=>{var p,w,b,R;if(!Object.is(r.current[n],h)){if(r.current[n]=h,n==="search")ie(),B(),S(1,te);else if(n==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let E=document.getElementById(ee);E?E.focus():(p=document.getElementById(Q))==null||p.focus()}if(S(7,()=>{var E;r.current.selectedItemId=(E=M())==null?void 0:E.id,C.emit()}),g||S(5,G),((w=f.current)==null?void 0:w.value)!==void 0){let E=h??"";(R=(b=f.current).onValueChange)==null||R.call(b,E);return}}C.emit()}},emit:()=>{d.current.forEach(n=>n())}}),[]),K=s.useMemo(()=>({value:(n,h,g)=>{var p;h!==((p=i.current.get(n))==null?void 0:p.value)&&(i.current.set(n,{value:h,keywords:g}),r.current.filtered.items.set(n,ve(h,g)),S(2,()=>{B(),C.emit()}))},item:(n,h)=>(u.current.add(n),h&&(l.current.has(h)?l.current.get(h).add(n):l.current.set(h,new Set([n]))),S(3,()=>{ie(),B(),r.current.value||te(),C.emit()}),()=>{i.current.delete(n),u.current.delete(n),r.current.filtered.items.delete(n);let g=M();S(4,()=>{ie(),g?.getAttribute("id")===n&&te(),C.emit()})}),group:n=>(l.current.has(n)||l.current.set(n,new Set),()=>{i.current.delete(n),l.current.delete(n)}),filter:()=>f.current.shouldFilter,label:y||t["aria-label"],getDisablePointerSelection:()=>f.current.disablePointerSelection,listId:Q,inputId:ee,labelId:le,listInnerRef:k}),[]);function ve(n,h){var g,p;let w=(p=(g=f.current)==null?void 0:g.filter)!=null?p:wr;return n?w(n,r.current.search,h):0}function B(){if(!r.current.search||f.current.shouldFilter===!1)return;let n=r.current.filtered.items,h=[];r.current.filtered.groups.forEach(p=>{let w=l.current.get(p),b=0;w.forEach(R=>{let E=n.get(R);b=Math.max(E,b)}),h.push([p,b])});let g=k.current;re().sort((p,w)=>{var b,R;let E=p.getAttribute("id"),T=w.getAttribute("id");return((b=n.get(T))!=null?b:0)-((R=n.get(E))!=null?R:0)}).forEach(p=>{let w=p.closest(Ie);w?w.appendChild(p.parentElement===w?p:p.closest(`${Ie} > *`)):g.appendChild(p.parentElement===g?p:p.closest(`${Ie} > *`))}),h.sort((p,w)=>w[1]-p[1]).forEach(p=>{var w;let b=(w=k.current)==null?void 0:w.querySelector(`${pe}[${ae}="${encodeURIComponent(p[0])}"]`);b?.parentElement.appendChild(b)})}function te(){let n=re().find(g=>g.getAttribute("aria-disabled")!=="true"),h=n?.getAttribute(ae);C.setState("value",h||void 0)}function ie(){var n,h,g,p;if(!r.current.search||f.current.shouldFilter===!1){r.current.filtered.count=u.current.size;return}r.current.filtered.groups=new Set;let w=0;for(let b of u.current){let R=(h=(n=i.current.get(b))==null?void 0:n.value)!=null?h:"",E=(p=(g=i.current.get(b))==null?void 0:g.keywords)!=null?p:[],T=ve(R,E);r.current.filtered.items.set(b,T),T>0&&w++}for(let[b,R]of l.current)for(let E of R)if(r.current.filtered.items.get(E)>0){r.current.filtered.groups.add(b);break}r.current.filtered.count=w}function G(){var n,h,g;let p=M();p&&(((n=p.parentElement)==null?void 0:n.firstChild)===p&&((g=(h=p.closest(pe))==null?void 0:h.querySelector(yr))==null||g.scrollIntoView({block:"nearest"})),p.scrollIntoView({block:"nearest"}))}function M(){var n;return(n=k.current)==null?void 0:n.querySelector(`${ut}[aria-selected="true"]`)}function re(){var n;return Array.from(((n=k.current)==null?void 0:n.querySelectorAll(rt))||[])}function se(n){let h=re()[n];h&&C.setState("value",h.getAttribute(ae))}function ce(n){var h;let g=M(),p=re(),w=p.findIndex(R=>R===g),b=p[w+n];(h=f.current)!=null&&h.loop&&(b=w+n<0?p[p.length-1]:w+n===p.length?p[0]:p[w+n]),b&&C.setState("value",b.getAttribute(ae))}function H(n){let h=M(),g=h?.closest(pe),p;for(;g&&!p;)g=n>0?Rr(g,pe):Pr(g,pe),p=g?.querySelector(rt);p?C.setState("value",p.getAttribute(ae)):ce(n)}let de=()=>se(re().length-1),ue=n=>{n.preventDefault(),n.metaKey?de():n.altKey?H(1):ce(1)},Z=n=>{n.preventDefault(),n.metaKey?se(0):n.altKey?H(-1):ce(-1)};return s.createElement(O.div,{ref:a,tabIndex:-1,...U,"cmdk-root":"",onKeyDown:n=>{var h;(h=U.onKeyDown)==null||h.call(U,n);let g=n.nativeEvent.isComposing||n.keyCode===229;if(!(n.defaultPrevented||g))switch(n.key){case"n":case"j":{F&&n.ctrlKey&&ue(n);break}case"ArrowDown":{ue(n);break}case"p":case"k":{F&&n.ctrlKey&&Z(n);break}case"ArrowUp":{Z(n);break}case"Home":{n.preventDefault(),se(0);break}case"End":{n.preventDefault(),de();break}case"Enter":{n.preventDefault();let p=M();if(p){let w=new Event(De);p.dispatchEvent(w)}}}}},s.createElement("label",{"cmdk-label":"",htmlFor:K.inputId,id:K.labelId,style:Dr},y),we(t,n=>s.createElement(pt.Provider,{value:C},s.createElement(mt.Provider,{value:K},n))))}),jr=s.forwardRef((t,a)=>{var r,u;let l=Y(),i=s.useRef(null),d=s.useContext(ft),f=xe(),y=xt(t),c=(u=(r=y.current)==null?void 0:r.forceMount)!=null?u:d?.forceMount;J(()=>{if(!c)return f.item(l,d?.id)},[c]);let x=gt(l,i,[t.value,t.children,i],t.keywords),m=Ve(),j=z(S=>S.value&&S.value===x.current),N=z(S=>c||f.filter()===!1?!0:S.search?S.filtered.items.get(l)>0:!0);s.useEffect(()=>{let S=i.current;if(!(!S||t.disabled))return S.addEventListener(De,D),()=>S.removeEventListener(De,D)},[N,t.onSelect,t.disabled]);function D(){var S,C;q(),(C=(S=y.current).onSelect)==null||C.call(S,x.current)}function q(){m.setState("value",x.current,!0)}if(!N)return null;let{disabled:F,value:U,onSelect:Q,forceMount:le,keywords:ee,...k}=t;return s.createElement(O.div,{ref:he(i,a),...k,id:l,"cmdk-item":"",role:"option","aria-disabled":!!F,"aria-selected":!!j,"data-disabled":!!F,"data-selected":!!j,onPointerMove:F||f.getDisablePointerSelection()?void 0:q,onClick:F?void 0:D},t.children)}),br=s.forwardRef((t,a)=>{let{heading:r,children:u,forceMount:l,...i}=t,d=Y(),f=s.useRef(null),y=s.useRef(null),c=Y(),x=xe(),m=z(N=>l||x.filter()===!1?!0:N.search?N.filtered.groups.has(d):!0);J(()=>x.group(d),[]),gt(d,f,[t.value,t.heading,y]);let j=s.useMemo(()=>({id:d,forceMount:l}),[l]);return s.createElement(O.div,{ref:he(f,a),...i,"cmdk-group":"",role:"presentation",hidden:m?void 0:!0},r&&s.createElement("div",{ref:y,"cmdk-group-heading":"","aria-hidden":!0,id:c},r),we(t,N=>s.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?c:void 0},s.createElement(ft.Provider,{value:j},N))))}),Nr=s.forwardRef((t,a)=>{let{alwaysRender:r,...u}=t,l=s.useRef(null),i=z(d=>!d.search);return!r&&!i?null:s.createElement(O.div,{ref:he(l,a),...u,"cmdk-separator":"",role:"separator"})}),Sr=s.forwardRef((t,a)=>{let{onValueChange:r,...u}=t,l=t.value!=null,i=Ve(),d=z(c=>c.search),f=z(c=>c.selectedItemId),y=xe();return s.useEffect(()=>{t.value!=null&&i.setState("search",t.value)},[t.value]),s.createElement(O.input,{ref:a,...u,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":y.listId,"aria-labelledby":y.labelId,"aria-activedescendant":f,id:y.inputId,type:"text",value:l?t.value:d,onChange:c=>{l||i.setState("search",c.target.value),r?.(c.target.value)}})}),Cr=s.forwardRef((t,a)=>{let{children:r,label:u="Suggestions",...l}=t,i=s.useRef(null),d=s.useRef(null),f=z(c=>c.selectedItemId),y=xe();return s.useEffect(()=>{if(d.current&&i.current){let c=d.current,x=i.current,m,j=new ResizeObserver(()=>{m=requestAnimationFrame(()=>{let N=c.offsetHeight;x.style.setProperty("--cmdk-list-height",N.toFixed(1)+"px")})});return j.observe(c),()=>{cancelAnimationFrame(m),j.unobserve(c)}}},[]),s.createElement(O.div,{ref:he(i,a),...l,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":f,"aria-label":u,id:y.listId},we(t,c=>s.createElement("div",{ref:he(d,y.listInnerRef),"cmdk-list-sizer":""},c)))}),Er=s.forwardRef((t,a)=>{let{open:r,onOpenChange:u,overlayClassName:l,contentClassName:i,container:d,...f}=t;return s.createElement(Jt,{open:r,onOpenChange:u},s.createElement(Qt,{container:d},s.createElement(er,{"cmdk-overlay":"",className:l}),s.createElement(tr,{"aria-label":t.label,"cmdk-dialog":"",className:i},s.createElement(ht,{ref:a,...f}))))}),_r=s.forwardRef((t,a)=>z(r=>r.filtered.count===0)?s.createElement(O.div,{ref:a,...t,"cmdk-empty":"",role:"presentation"}):null),kr=s.forwardRef((t,a)=>{let{progress:r,children:u,label:l="Loading...",...i}=t;return s.createElement(O.div,{ref:a,...i,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":l},we(t,d=>s.createElement("div",{"aria-hidden":!0},d)))}),P=Object.assign(ht,{List:Cr,Item:jr,Input:Sr,Group:br,Separator:Nr,Dialog:Er,Empty:_r,Loading:kr});function Rr(t,a){let r=t.nextElementSibling;for(;r;){if(r.matches(a))return r;r=r.nextElementSibling}}function Pr(t,a){let r=t.previousElementSibling;for(;r;){if(r.matches(a))return r;r=r.previousElementSibling}}function xt(t){let a=s.useRef(t);return J(()=>{a.current=t}),a}var J=typeof window>"u"?s.useEffect:s.useLayoutEffect;function ne(t){let a=s.useRef();return a.current===void 0&&(a.current=t()),a}function z(t){let a=Ve(),r=()=>t(a.snapshot());return s.useSyncExternalStore(a.subscribe,r,r)}function gt(t,a,r,u=[]){let l=s.useRef(),i=xe();return J(()=>{var d;let f=(()=>{var c;for(let x of r){if(typeof x=="string")return x.trim();if(typeof x=="object"&&"current"in x)return x.current?(c=x.current.textContent)==null?void 0:c.trim():l.current}})(),y=u.map(c=>c.trim());i.value(t,f,y),(d=a.current)==null||d.setAttribute(ae,f),l.current=f}),l}var Ir=()=>{let[t,a]=s.useState(),r=ne(()=>new Map);return J(()=>{r.current.forEach(u=>u()),r.current=new Map},[t]),(u,l)=>{r.current.set(u,l),a({})}};function Ar(t){let a=t.type;return typeof a=="function"?a(t.props):"render"in a?a.render(t.props):t}function we({asChild:t,children:a},r){return t&&s.isValidElement(a)?s.cloneElement(Ar(a),{ref:a.ref},r(a.props.children)):r(a)}var Dr={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Me=s.forwardRef(({className:t,...a},r)=>e.jsx(P,{ref:r,className:$("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...a}));Me.displayName=P.displayName;const Oe=s.forwardRef(({className:t,...a},r)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(ct,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(P.Input,{ref:r,className:$("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...a})]}));Oe.displayName=P.Input.displayName;const Mr=s.forwardRef(({className:t,...a},r)=>e.jsx(P.List,{ref:r,className:$("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...a}));Mr.displayName=P.List.displayName;const Fe=s.forwardRef((t,a)=>e.jsx(P.Empty,{ref:a,className:"py-6 text-center text-sm",...t}));Fe.displayName=P.Empty.displayName;const $e=s.forwardRef(({className:t,...a},r)=>e.jsx(P.Group,{ref:r,className:$("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...a}));$e.displayName=P.Group.displayName;const Or=s.forwardRef(({className:t,...a},r)=>e.jsx(P.Separator,{ref:r,className:$("-mx-1 h-px bg-border",t),...a}));Or.displayName=P.Separator.displayName;const Te=s.forwardRef(({className:t,...a},r)=>e.jsx(P.Item,{ref:r,className:$("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",t),...a}));Te.displayName=P.Item.displayName;var je="Popover",[vt,ps]=Dt(je,[nt]),ge=nt(),[Fr,V]=vt(je),yt=t=>{const{__scopePopover:a,children:r,open:u,defaultOpen:l,onOpenChange:i,modal:d=!1}=t,f=ge(a),y=s.useRef(null),[c,x]=s.useState(!1),[m,j]=It({prop:u,defaultProp:l??!1,onChange:i,caller:je});return e.jsx(At,{...f,children:e.jsx(Fr,{scope:a,contentId:Y(),triggerRef:y,open:m,onOpenChange:j,onOpenToggle:s.useCallback(()=>j(N=>!N),[j]),hasCustomAnchor:c,onCustomAnchorAdd:s.useCallback(()=>x(!0),[]),onCustomAnchorRemove:s.useCallback(()=>x(!1),[]),modal:d,children:r})})};yt.displayName=je;var wt="PopoverAnchor",$r=s.forwardRef((t,a)=>{const{__scopePopover:r,...u}=t,l=V(wt,r),i=ge(r),{onCustomAnchorAdd:d,onCustomAnchorRemove:f}=l;return s.useEffect(()=>(d(),()=>f()),[d,f]),e.jsx(lt,{...i,...u,ref:a})});$r.displayName=wt;var jt="PopoverTrigger",bt=s.forwardRef((t,a)=>{const{__scopePopover:r,...u}=t,l=V(jt,r),i=ge(r),d=ot(a,l.triggerRef),f=e.jsx(O.button,{type:"button","aria-haspopup":"dialog","aria-expanded":l.open,"aria-controls":l.contentId,"data-state":_t(l.open),...u,ref:d,onClick:fe(t.onClick,l.onOpenToggle)});return l.hasCustomAnchor?f:e.jsx(lt,{asChild:!0,...i,children:f})});bt.displayName=jt;var qe="PopoverPortal",[Tr,Lr]=vt(qe,{forceMount:void 0}),Nt=t=>{const{__scopePopover:a,forceMount:r,children:u,container:l}=t,i=V(qe,a);return e.jsx(Tr,{scope:a,forceMount:r,children:e.jsx(it,{present:r||i.open,children:e.jsx(Mt,{asChild:!0,container:l,children:u})})})};Nt.displayName=qe;var oe="PopoverContent",St=s.forwardRef((t,a)=>{const r=Lr(oe,t.__scopePopover),{forceMount:u=r.forceMount,...l}=t,i=V(oe,t.__scopePopover);return e.jsx(it,{present:u||i.open,children:i.modal?e.jsx(Vr,{...l,ref:a}):e.jsx(qr,{...l,ref:a})})});St.displayName=oe;var zr=Ot("PopoverContent.RemoveScroll"),Vr=s.forwardRef((t,a)=>{const r=V(oe,t.__scopePopover),u=s.useRef(null),l=ot(a,u),i=s.useRef(!1);return s.useEffect(()=>{const d=u.current;if(d)return Kt(d)},[]),e.jsx(Bt,{as:zr,allowPinchZoom:!0,children:e.jsx(Ct,{...t,ref:l,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:fe(t.onCloseAutoFocus,d=>{d.preventDefault(),i.current||r.triggerRef.current?.focus()}),onPointerDownOutside:fe(t.onPointerDownOutside,d=>{const f=d.detail.originalEvent,y=f.button===0&&f.ctrlKey===!0,c=f.button===2||y;i.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:fe(t.onFocusOutside,d=>d.preventDefault(),{checkForDefaultPrevented:!1})})})}),qr=s.forwardRef((t,a)=>{const r=V(oe,t.__scopePopover),u=s.useRef(!1),l=s.useRef(!1);return e.jsx(Ct,{...t,ref:a,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{t.onCloseAutoFocus?.(i),i.defaultPrevented||(u.current||r.triggerRef.current?.focus(),i.preventDefault()),u.current=!1,l.current=!1},onInteractOutside:i=>{t.onInteractOutside?.(i),i.defaultPrevented||(u.current=!0,i.detail.originalEvent.type==="pointerdown"&&(l.current=!0));const d=i.target;r.triggerRef.current?.contains(d)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&l.current&&i.preventDefault()}})}),Ct=s.forwardRef((t,a)=>{const{__scopePopover:r,trapFocus:u,onOpenAutoFocus:l,onCloseAutoFocus:i,disableOutsidePointerEvents:d,onEscapeKeyDown:f,onPointerDownOutside:y,onFocusOutside:c,onInteractOutside:x,...m}=t,j=V(oe,r),N=ge(r);return Gt(),e.jsx(Ht,{asChild:!0,loop:!0,trapped:u,onMountAutoFocus:l,onUnmountAutoFocus:i,children:e.jsx(Ft,{asChild:!0,disableOutsidePointerEvents:d,onInteractOutside:x,onEscapeKeyDown:f,onPointerDownOutside:y,onFocusOutside:c,onDismiss:()=>j.onOpenChange(!1),children:e.jsx($t,{"data-state":_t(j.open),role:"dialog",id:j.contentId,...N,...m,ref:a,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Et="PopoverClose",Ur=s.forwardRef((t,a)=>{const{__scopePopover:r,...u}=t,l=V(Et,r);return e.jsx(O.button,{type:"button",...u,ref:a,onClick:fe(t.onClick,()=>l.onOpenChange(!1))})});Ur.displayName=Et;var Kr="PopoverArrow",Br=s.forwardRef((t,a)=>{const{__scopePopover:r,...u}=t,l=ge(r);return e.jsx(Tt,{...l,...u,ref:a})});Br.displayName=Kr;function _t(t){return t?"open":"closed"}var Gr=yt,Hr=bt,Zr=Nt,kt=St;const st=Gr,at=Hr,Le=s.forwardRef(({className:t,align:a="center",sideOffset:r=4,...u},l)=>e.jsx(Zr,{children:e.jsx(kt,{ref:l,align:a,sideOffset:r,className:$("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...u})}));Le.displayName=kt.displayName;const Xr=()=>{const{toast:t}=Lt(),[a,r]=s.useState([]),[u,l]=s.useState(!0),[i,d]=s.useState(!1),[f,y]=s.useState(!1),[c,x]=s.useState(null),[m,j]=s.useState({student_id:"",absence_date:""}),[N,D]=s.useState([]),[q,F]=s.useState([]),[U,Q]=s.useState(!1),[le,ee]=s.useState(!1),[k,S]=s.useState(1),[C,K]=s.useState({x:0,y:0}),[ve,B]=s.useState(!1),[te,ie]=s.useState({x:0,y:0}),[G,M]=s.useState(!1),[re,se]=s.useState("view"),[ce,H]=s.useState(!1),[de,ue]=s.useState(null);s.useEffect(()=>{Z(),n(),h()},[]);const Z=async()=>{try{l(!0);const{data:o,error:v}=await A.from("excuse_applications").select(`
          *,
          students!student_id (
            id,
            firstname,
            surname,
            student_id,
            program,
            year,
            section
          ),
          sessions!session_id (
            id,
            title,
            date
          )
        `).order("created_at",{ascending:!1});if(v)throw v;console.log("Fetched excuses data:",o),r(o||[])}catch(o){console.error("Error fetching excuses:",o),t({title:"Error",description:"Failed to fetch excuse applications",variant:"destructive"})}finally{l(!1)}},n=async()=>{try{const{data:o,error:v}=await A.from("students").select("id, firstname, surname, student_id, program, year, section").order("firstname");if(v)throw v;D(o||[])}catch(o){console.error("Error fetching students:",o)}},h=async()=>{try{const{data:o,error:v}=await A.from("sessions").select("id, title, date").order("date",{ascending:!1});if(v)throw v;F(o||[])}catch(o){console.error("Error fetching sessions:",o)}},g=async()=>{try{let o=null;if(m.excuse_image){const v=m.excuse_image.name.split(".").pop(),I=`excuse-letters/${`${Date.now()}-${Math.random().toString(36).substring(2,15)}.${v}`}`,{error:me}=await A.storage.from("excuse-letters").upload(I,m.excuse_image);if(me)throw me;const{data:{publicUrl:be}}=A.storage.from("excuse-letters").getPublicUrl(I);o=be}if(G&&c){const{error:v}=await A.from("excuse_applications").update({student_id:parseInt(m.student_id),session_id:m.session_id?parseInt(m.session_id):null,absence_date:m.absence_date,documentation_url:o||m.documentation_url,updated_at:new Date().toISOString()}).eq("id",c.id);if(v)throw v;t({title:"Success",description:"Excuse application updated successfully"})}else{const{error:v}=await A.from("excuse_applications").insert([{student_id:parseInt(m.student_id),session_id:m.session_id?parseInt(m.session_id):null,absence_date:m.absence_date||new Date().toISOString().split("T")[0],documentation_url:o||m.documentation_url,status:"pending"}]);if(v)throw v;t({title:"Success",description:"Excuse application submitted successfully"})}d(!1),M(!1),x(null),j({student_id:"",absence_date:""}),Z()}catch(o){console.error("Error submitting excuse:",o),t({title:"Error",description:G?"Failed to update excuse application":"Failed to submit excuse application",variant:"destructive"})}},p=async(o,v,X)=>{try{const{error:I}=await A.from("excuse_applications").update({status:v,review_notes:X,reviewed_at:new Date().toISOString()}).eq("id",o);if(I)throw I;t({title:"Success",description:`Excuse application ${v}`}),Z(),y(!1)}catch(I){console.error("Error updating status:",I),t({title:"Error",description:"Failed to update status",variant:"destructive"})}},w=async o=>{try{console.log("Deleting excuse with ID:",o,"Type:",typeof o);const{data:v,error:X}=await A.from("excuse_applications").select("id").limit(1);X?console.error("Error checking ID format:",X):console.log("Sample ID from database:",v?.[0]?.id,"Type:",typeof v?.[0]?.id);const{error:I,count:me}=await A.from("excuse_applications").delete().eq("id",o);console.log("Delete result - Error:",I,"Count:",me);const{data:be,error:Rt}=await A.from("excuse_applications").select("*").eq("id",o).single();if(console.log("Record check - Data:",be,"Error:",Rt),I)throw console.error("Supabase delete error:",I),I;if(me===0){console.log("No records were deleted, trying alternative approach...");const{error:Pt,count:Ke}=await A.from("excuse_applications").delete().eq("id",parseInt(o.toString()));if(console.log("Alternative delete result - Error:",Pt,"Count:",Ke),Ke===0){t({title:"Warning",description:"No record found to delete",variant:"destructive"});return}}console.log("Delete successful, refreshing list..."),t({title:"Success",description:"Excuse application deleted successfully"}),await Z(),H(!1),ue(null)}catch(v){console.error("Error deleting excuse:",v),t({title:"Error",description:"Failed to delete excuse application",variant:"destructive"})}},b=o=>{k>1&&(B(!0),ie({x:o.clientX-C.x,y:o.clientY-C.y}))},R=o=>{if(ve&&k>1){const v=1/k;K({x:(o.clientX-te.x)*v,y:(o.clientY-te.y)*v})}},E=()=>{B(!1)},T=o=>{S(o),o<=1&&K({x:0,y:0})},Ue=o=>{switch(o){case"approved":return e.jsxs(Ne,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:[e.jsx(lr,{className:"w-3 h-3 mr-1"}),"Approved"]});case"rejected":return e.jsxs(Ne,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:[e.jsx(or,{className:"w-3 h-3 mr-1"}),"Rejected"]});default:return e.jsxs(Ne,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:[e.jsx(Je,{className:"w-3 h-3 mr-1"}),"Pending"]})}};return e.jsxs("div",{className:"flex-1 space-y-4 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Excuse Applications"}),e.jsx("p",{className:"text-muted-foreground",children:"Review and manage student excuse applications for absences"})]}),e.jsxs(_,{className:"bg-gradient-primary shadow-glow h-9",onClick:()=>d(!0),children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"New Application"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs(Zt,{defaultValue:"all",onValueChange:o=>{},children:[e.jsx(Xt,{className:"w-[180px]",children:e.jsx(Wt,{placeholder:"Filter by status"})}),e.jsxs(Yt,{children:[e.jsx(ye,{value:"all",children:"All Statuses"}),e.jsx(ye,{value:"pending",children:"Pending"}),e.jsx(ye,{value:"approved",children:"Approved"}),e.jsx(ye,{value:"rejected",children:"Rejected"})]})]})}),e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(ct,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(Ge,{placeholder:"Search applications...",className:"pl-10",onChange:o=>{}})]})]}),u?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})}):a.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:a.map(o=>e.jsxs(Be,{className:"hover:shadow-md transition-shadow",children:[e.jsx(Vt,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(qt,{className:"text-base font-semibold text-gray-900 truncate",children:[o.students?.firstname," ",o.students?.surname]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[o.students?.student_id," • ",o.students?.program]})]}),e.jsx("div",{className:"ml-2",children:Ue(o.status)})]})}),e.jsx(Ut,{className:"pt-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(He,{className:"h-4 w-4 mr-2 text-gray-400"}),W(new Date(o.absence_date),"MMM d, yyyy")]}),o.documentation_url&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2 text-gray-400"}),e.jsx("span",{className:"truncate",children:"Documentation attached"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Je,{className:"h-4 w-4 mr-2 text-gray-400"}),"Submitted ",W(new Date(o.created_at),"MMM d, yyyy")]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(_,{variant:"outline",size:"sm",className:"flex-1 h-8",onClick:()=>{x(o),se("view"),y(!0)},children:[e.jsx(ar,{className:"h-3 w-3 mr-1"}),"View"]}),e.jsxs(_,{variant:"outline",size:"sm",className:"flex-1 h-8",onClick:()=>{x(o),se("edit"),M(!0),j({student_id:o.student_id?.toString()||"",session_id:o.session_id?.toString()||"",absence_date:o.absence_date||"",documentation_url:o.documentation_url||""}),d(!0)},children:[e.jsx(nr,{className:"h-3 w-3 mr-1"}),"Edit"]}),e.jsx(_,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",onClick:()=>{ue(o.id),H(!0)},children:e.jsx(sr,{className:"h-3 w-3"})})]})]})})]},o.id))}):e.jsx(Be,{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Ze,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No excuse applications"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Get started by creating a new excuse application."}),e.jsxs(_,{onClick:()=>d(!0),className:"bg-gradient-primary shadow-glow",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"New Application"]})]})}),e.jsx(Ce,{open:i,onOpenChange:o=>{d(o),o||(M(!1),x(null),j({student_id:"",session_id:"",absence_date:"",documentation_url:""}))},children:e.jsxs(Ee,{className:"max-w-md",children:[e.jsxs(_e,{children:[e.jsx(ke,{children:G?"Edit Excuse Application":"New Excuse Application"}),e.jsx(Xe,{children:G?"Update the excuse application details.":"Submit a new excuse application for a student absence."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(L,{htmlFor:"student",children:"Student"}),e.jsxs(st,{open:U,onOpenChange:Q,children:[e.jsx(at,{asChild:!0,children:e.jsxs(_,{variant:"outline",role:"combobox","aria-expanded":U,className:"w-full justify-between",children:[m.student_id?N.find(o=>o.id.toString()===m.student_id)?.firstname+" "+N.find(o=>o.id.toString()===m.student_id)?.surname+" ("+N.find(o=>o.id.toString()===m.student_id)?.student_id+")":"Select student...",e.jsx(Qe,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Le,{className:"w-full p-0 z-[100]",children:e.jsxs(Me,{children:[e.jsx(Oe,{placeholder:"Search students..."}),e.jsx(Fe,{children:"No student found."}),e.jsx($e,{children:N.map(o=>e.jsxs(Te,{onSelect:()=>{j(v=>({...v,student_id:o.id.toString()})),Q(!1)},children:[e.jsx(Se,{className:$("mr-2 h-4 w-4",m.student_id===o.id.toString()?"opacity-100":"opacity-0")}),o.firstname," ",o.surname," (",o.student_id,")"]},o.id))})]})})]})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"session",children:"Session *"}),e.jsxs(st,{open:le,onOpenChange:ee,children:[e.jsx(at,{asChild:!0,children:e.jsxs(_,{variant:"outline",role:"combobox","aria-expanded":le,className:"w-full justify-between",children:[m.session_id?q.find(o=>o.id.toString()===m.session_id)?.title+" - "+W(new Date(q.find(o=>o.id.toString()===m.session_id)?.date),"MMM d, yyyy"):"Select session...",e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(He,{className:"h-4 w-4 shrink-0 opacity-50"}),e.jsx(Qe,{className:"h-4 w-4 shrink-0 opacity-50"})]})]})}),e.jsx(Le,{className:"w-full p-0 z-[100]",children:e.jsxs(Me,{children:[e.jsx(Oe,{placeholder:"Search sessions or dates..."}),e.jsx(Fe,{children:"No session found."}),e.jsx($e,{children:q.map(o=>e.jsxs(Te,{onSelect:()=>{j(v=>({...v,session_id:o.id.toString()})),ee(!1)},children:[e.jsx(Se,{className:$("mr-2 h-4 w-4",m.session_id===o.id.toString()?"opacity-100":"opacity-0")}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:o.title}),e.jsx("span",{className:"text-sm text-muted-foreground",children:W(new Date(o.date),"EEEE, MMM d, yyyy")})]})]},o.id))})]})})]})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"excuse-image",children:"Handwritten Excuse Letter"}),e.jsx(Ge,{id:"excuse-image",type:"file",accept:"image/*",onChange:o=>{const v=o.target.files?.[0];v&&j(X=>({...X,excuse_image:v}))},className:"cursor-pointer"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Please attach a clear photo of your handwritten excuse letter"})]})]}),e.jsxs(We,{children:[e.jsx(_,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(_,{onClick:g,disabled:!m.student_id||!m.session_id||!m.excuse_image,children:"Submit Application"})]})]})}),e.jsx(Ce,{open:f,onOpenChange:o=>{y(o),o||(S(1),K({x:0,y:0}),B(!1))},children:e.jsxs(Ee,{className:"max-w-7xl w-full h-[85vh] flex flex-col",children:[e.jsx(_e,{className:"flex-shrink-0",children:e.jsx(ke,{children:"Excuse Application Details"})}),c&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 flex-1 overflow-hidden",children:[e.jsxs("div",{className:"space-y-4 lg:col-span-1",children:[e.jsxs("div",{children:[e.jsx(L,{className:"text-sm font-medium",children:"Student"}),e.jsxs("p",{className:"text-sm font-medium",children:[c.students?.firstname||"Unknown"," ",c.students?.surname||"Student"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[c.students?.student_id||"N/A"," • ",c.students?.program||"N/A"]})]}),e.jsxs("div",{children:[e.jsx(L,{className:"text-sm font-medium",children:"Status"}),e.jsx("div",{className:"mt-1",children:Ue(c.status)})]}),e.jsxs("div",{children:[e.jsx(L,{className:"text-sm font-medium",children:"Absence Date"}),e.jsx("p",{className:"text-sm",children:W(new Date(c.absence_date),"EEEE, MMMM d, yyyy")})]}),c.review_notes&&e.jsxs("div",{children:[e.jsx(L,{className:"text-sm font-medium",children:"Review Notes"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:c.review_notes})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Submitted: ",W(new Date(c.created_at),"MMM d, yyyy h:mm a"),c.reviewed_at&&e.jsxs("span",{className:"block mt-1",children:["Reviewed: ",W(new Date(c.reviewed_at),"MMM d, yyyy h:mm a")]})]}),c.status==="pending"&&e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(_,{variant:"outline",className:"text-green-600 border-green-200 hover:bg-green-50",onClick:()=>p(c.id,"approved"),children:[e.jsx(Se,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(_,{variant:"outline",className:"text-red-600 border-red-200 hover:bg-red-50",onClick:()=>p(c.id,"rejected"),children:[e.jsx(zt,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]}),e.jsxs("div",{className:"lg:col-span-2 flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(L,{className:"text-sm font-medium",children:"Excuse Letter"}),c.documentation_url&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{variant:"outline",size:"sm",onClick:()=>T(Math.max(.5,k-.25)),children:e.jsx(cr,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[Math.round(k*100),"%"]}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>T(Math.min(3,k+.25)),children:e.jsx(ir,{className:"h-4 w-4"})}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>T(1),className:"ml-2",children:"Reset"})]})]}),c.documentation_url?e.jsx("div",{className:"border rounded-lg overflow-hidden flex-1 bg-gray-50 relative cursor-grab active:cursor-grabbing",onMouseDown:b,onMouseMove:R,onMouseUp:E,onMouseLeave:E,children:e.jsx("img",{src:c.documentation_url,alt:"Excuse letter",className:"transition-transform duration-200 max-w-none object-contain w-full h-full",style:{transform:`scale(${k}) translate(${C.x}px, ${C.y}px)`,transformOrigin:"center center"},draggable:!1})}):e.jsx("p",{className:"text-sm text-gray-400",children:"No excuse letter attached"})]})]})]})}),e.jsx(Ce,{open:ce,onOpenChange:H,children:e.jsxs(Ee,{className:"max-w-md",children:[e.jsxs(_e,{children:[e.jsx(ke,{children:"Delete Excuse Application"}),e.jsx(Xe,{children:"Are you sure you want to delete this excuse application? This action cannot be undone."})]}),e.jsxs(We,{children:[e.jsx(_,{variant:"outline",onClick:()=>H(!1),children:"Cancel"}),e.jsx(_,{variant:"destructive",onClick:()=>de&&w(de),children:"Delete"})]})]})})]})},fs=()=>e.jsx(rr,{children:e.jsx(Xr,{})});export{fs as default};
