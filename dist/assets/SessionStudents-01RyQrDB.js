import{c as D,h as Q,d as W,r as l,j as e}from"./index-CZr3ktf2.js";import{C as Y,c as J}from"./card-BaLCcYSu.js";import{B as c}from"./index-DC1ZGnvg.js";import{I as K}from"./input-CgEU1t-I.js";import{S as X,a as Z,b as ee,c as se,d as w}from"./select-ryfx1BI1.js";import{L as S,G as te,U as ae,h as re,f as ne}from"./Layout-d_Uy6Fn7.js";import{f as ie}from"./supabaseService-in1CTy96.js";import{R as le}from"./refresh-cw-CxnXuRLJ.js";import{S as oe}from"./search-C1M6jnsu.js";import{S as z}from"./square-guD4zESV.js";import{C as ce,a as de,b as me}from"./chevrons-right-C0R8r276.js";import"./index-3K0ulQV1.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=D("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=D("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=D("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);function Ce(){const{sessionId:N}=Q(),E=W(),[o,U]=l.useState(null),[C,R]=l.useState([]),[k,P]=l.useState([]),[u,V]=l.useState([]),[d,M]=l.useState(""),[H,$]=l.useState(!0),[h,v]=l.useState(null),[i,I]=l.useState({currentPage:1,pageSize:25,totalCount:0,totalPages:0}),[m,A]=l.useState(new Set),y=u.length>0&&u.every(s=>m.has(s.id)),B=()=>{const s=new Set(m);y?u.forEach(t=>s.delete(t.id)):u.forEach(t=>s.add(t.id)),A(s)},F=s=>{const t=new Set(m);t.has(s)?t.delete(s):t.add(s),A(t)};l.useEffect(()=>{(async()=>{try{if($(!0),v(null),!N)throw new Error("No session ID provided");const t=parseInt(N,10);if(isNaN(t)||t<=0)throw new Error("Invalid session ID");console.log(`Fetching students for session ID: ${t}`);const a=await ie(t);if(!a?.session)throw console.error("No session data in response:",a),new Error("Session data not found in response");const r=a.session,x=a.students||[],p={id:r.id,title:r.title,program:r.program,year:r.year,section:r.section,date:r.date,time_in:r.time_in||"",time_out:r.time_out||"",description:r.description||"",type:r.type||"class"};U(p);const b=x.map(n=>({...n,full_name:n.full_name||`${n.firstname||""} ${n.surname||""}`.trim(),status:n.status||"absent",time_in:n.time_in||null,time_out:n.time_out||null})).sort((n,f)=>n.full_name.localeCompare(f.full_name));R(b),P(b)}catch(t){const a=t;console.error("Error fetching session students:",{error:a.message,sessionId:N,responseStatus:a.response?.status,responseData:a.response?.data}),a.response?v(`Server error: ${a.response.status} - ${a.response.data?.message||"Unknown error"}`):a.request?v("No response from server. Please check your connection."):v(`Error: ${a.message||"An unknown error occurred"}`)}finally{$(!1)}})()},[N]);const T=s=>{if(!s)return"";const[t,a]=s.split(":"),r=parseInt(t,10),x=r>=12?"PM":"AM";return`${r%12||12}:${a} ${x}`};l.useEffect(()=>{if(!d){P(C);return}const s=d.toLowerCase(),t=C.filter(a=>a.full_name.toLowerCase().includes(s)||a.student_id.toLowerCase().includes(s));P(t)},[d,C]),l.useEffect(()=>{const s=k.length,t=Math.ceil(s/i.pageSize),a=i.currentPage>t&&t>0?1:i.currentPage;I(p=>({...p,currentPage:a,totalCount:s,totalPages:t}));const r=(a-1)*i.pageSize,x=r+i.pageSize;V(k.slice(r,x))},[k,i.pageSize,i.currentPage]);const j=s=>{s<1||s>i.totalPages||I(t=>({...t,currentPage:s}))},G=s=>{I(t=>({...t,pageSize:s,currentPage:1}))},O=()=>{const{currentPage:s,totalPages:t,totalCount:a,pageSize:r}=i;if(t<=1)return null;const x=()=>{const f=[],g=[];for(let L=Math.max(2,s-2);L<=Math.min(t-1,s+2);L++)f.push(L);return s-2>2?g.push(1,"..."):g.push(1),g.push(...f),s+2<t-1?g.push("...",t):t>1&&g.push(t),g},p=(s-1)*r+1,b=Math.min(s*r,a);return e.jsxs("div",{className:"flex items-center justify-between px-6 py-3 bg-white border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-700",children:[e.jsxs("span",{children:["Showing ",p.toLocaleString()," to ",b.toLocaleString()," of ",a.toLocaleString()," students"]}),e.jsxs("div",{className:"ml-4 flex items-center space-x-2",children:[e.jsx("span",{children:"Show:"}),e.jsxs(X,{value:r.toString(),onValueChange:n=>G(parseInt(n)),children:[e.jsx(Z,{className:"w-20 h-8",children:e.jsx(ee,{})}),e.jsxs(se,{children:[e.jsx(w,{value:"10",children:"10"}),e.jsx(w,{value:"25",children:"25"}),e.jsx(w,{value:"50",children:"50"}),e.jsx(w,{value:"100",children:"100"})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>j(1),disabled:s===1,className:"h-8 w-8 p-0",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>j(s-1),disabled:s===1,className:"h-8 w-8 p-0",children:e.jsx(de,{className:"h-4 w-4"})}),x().map((n,f)=>e.jsx(c,{variant:s===n?"default":"outline",size:"sm",onClick:()=>typeof n=="number"&&j(n),disabled:typeof n=="string",className:"h-8 min-w-[32px] px-2",children:n},f)),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>j(s+1),disabled:s===t,className:"h-8 w-8 p-0",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>j(t),disabled:s===t,className:"h-8 w-8 p-0",children:e.jsx(me,{className:"h-4 w-4"})})]})]})};return H?e.jsx(S,{children:e.jsxs("div",{className:"p-8 flex flex-col items-center justify-center min-h-screen",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading session details..."})]})}):h?e.jsx(S,{children:e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-education-navy mb-4",children:h.includes("not found")?"Session Not Found":"Error Loading Session"}),e.jsx("p",{className:"text-lg text-muted-foreground mb-6",children:h.includes("ID")?h:h.includes("not found")?"The requested session could not be found. It may have been deleted or moved.":"An error occurred while loading the session details. Please try again."}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsxs(c,{onClick:()=>E("/schedule"),variant:"outline",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Back to Schedule"]}),!h.includes("ID")&&e.jsxs(c,{onClick:()=>window.location.reload(),variant:"default",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Try Again"]})]})]})})}):o?e.jsx(S,{children:e.jsxs("div",{className:"px-6 py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-foreground",children:o.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View and manage all required attendees enrolled in this session"})]}),e.jsx(Y,{className:"border-0 shadow-sm overflow-hidden w-full",children:e.jsxs(J,{className:"p-6",children:[e.jsxs("div",{className:"text-center space-y-0.5 mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:new Date(o.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[T(o.time_in)," - ",o.time_out?T(o.time_out):"TBD"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 mb-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-primary/5 to-primary/10 p-2 rounded-lg border border-primary/10 hover:border-primary/20 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-md bg-primary/10 text-primary",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium text-muted-foreground mb-0.5",children:"Program"}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:o.program})]})]})}),e.jsx("div",{className:"bg-accent/5 p-2 rounded-lg border border-accent/10",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-md bg-accent/20 text-accent",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-[11px] font-medium text-muted-foreground",children:"Year & Section"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:o.year}),e.jsx("span",{className:"text-muted-foreground",children:"•"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:o.section})]})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-education-navy/5 to-education-navy/10 p-2 rounded-lg border border-education-navy/10 hover:border-education-navy/20 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-md bg-education-navy/10 text-education-navy",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium text-muted-foreground mb-0.5",children:"Required Attendees"}),e.jsx("p",{className:"font-medium text-foreground",children:e.jsx("span",{className:"text-xl font-bold mr-1",children:i.totalCount})})]})]})})]}),o.description&&e.jsx("div",{className:"mb-6 p-2 bg-muted/10 rounded-md border border-muted/20 hover:border-muted/30 transition-colors group",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"p-1 rounded-sm bg-primary/5 text-primary mt-0.5",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-info",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 16v-4"}),e.jsx("path",{d:"M12 8h.01"})]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-0.5",children:"Session Notes"}),e.jsx("p",{className:"text-xs text-foreground/80",children:o.description})]})]})}),e.jsxs("div",{className:"border-t border-border/30 pt-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-foreground",children:["Students ",i.totalPages>1&&`(Page ${i.currentPage} of ${i.totalPages})`]}),e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(K,{placeholder:"Search by name or ID...",className:"pl-10 h-9 w-full bg-background/80 border-border/50 hover:border-border/70 focus:border-primary/50 transition-colors",value:d,onChange:s=>M(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:B,className:"h-8",children:[y?e.jsx(_,{className:"w-3.5 h-3.5 mr-1"}):e.jsx(z,{className:"w-3.5 h-3.5 mr-1"}),y?"Unselect page":"Select page"]}),e.jsxs(c,{variant:"default",size:"sm",disabled:m.size===0,className:"h-8",children:["Mark Present (",m.size,")"]})]})]}),u.length>0?e.jsxs("div",{className:"bg-white rounded-md border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{className:"text-xs text-gray-500",children:[e.jsx("th",{scope:"col",className:"px-6 py-2 text-left font-medium",children:e.jsxs("button",{"aria-label":"Toggle select all",onClick:s=>{s.preventDefault(),B()},className:"inline-flex items-center gap-2",children:[y?e.jsx(_,{className:"w-3.5 h-3.5"}):e.jsx(z,{className:"w-3.5 h-3.5"}),"Student"]})}),e.jsx("th",{scope:"col",className:"px-6 py-2 text-left font-medium",children:"ID"}),e.jsx("th",{scope:"col",className:"px-6 py-2 text-left font-medium",children:"Program"}),e.jsx("th",{scope:"col",className:"px-6 py-2 text-left font-medium",children:"Year & Section"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-2 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[e.jsx("button",{"aria-label":m.has(s.id)?"Unselect student":"Select student",onClick:t=>{t.preventDefault(),F(s.id)},className:"inline-flex items-center gap-2 mr-2 align-middle",children:m.has(s.id)?e.jsx(_,{className:"w-3.5 h-3.5 text-primary"}):e.jsx(z,{className:"w-3.5 h-3.5 text-muted-foreground"})}),s.full_name]})}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-gray-500 text-sm",children:s.student_id}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-[120px]",children:s.program})}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-500",children:[s.year," • ",s.section]})})]},s.id))})]})}),e.jsx(O,{})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-muted/30 mb-4",children:e.jsx(re,{className:"w-12 h-12 text-muted-foreground/60"})}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:d?"No matching students found":"No students enrolled"}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto mb-6",children:d?"Try adjusting your search or filter criteria":"There are no students enrolled in this session matching the selected criteria."}),d&&e.jsx(c,{variant:"outline",onClick:()=>M(""),className:"rounded-full px-6",children:"Clear search"})]})]})]})})]})}):e.jsx(S,{children:e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-education-navy mb-4",children:"Session not found"}),e.jsxs(c,{onClick:()=>E(-1),variant:"outline",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Go Back"]})]})})})}export{Ce as default};
