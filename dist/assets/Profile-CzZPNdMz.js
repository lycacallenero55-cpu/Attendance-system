import{c as Le,J as _e,r,j as e,n as Ae,P as b,F as Ie,H as z,k as L,u as Re,s as E,e as w}from"./index-UN-xnaxC.js";import{L as U,h as W,C as ke,D as J,b as K,c as Y,d as Q,e as X,g as Z}from"./Layout-8fUh4t3a.js";import{C as Ue,a as Fe,b as De,d as Oe,c as Me}from"./card-CBRuYr9b.js";import{B as ze}from"./badge-CJDHipBu.js";import{B as v}from"./index-BHXN4u0M.js";import{I as P}from"./input-DAyyV8TZ.js";import{L as C}from"./label-BDGLgW5M.js";import{M as Te}from"./mail-BkMxbndh.js";import{S as qe}from"./square-pen-DZSYq43Y.js";import{E as F}from"./eye-off-9VsjkpZ8.js";import{E as D}from"./eye-DOoouUEt.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=Le("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);var O={exports:{}},M={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var se;function $e(){if(se)return M;se=1;var s=_e();function a(l,u){return l===u&&(l!==0||1/l===1/u)||l!==l&&u!==u}var o=typeof Object.is=="function"?Object.is:a,i=s.useState,d=s.useEffect,t=s.useLayoutEffect,f=s.useDebugValue;function c(l,u){var g=u(),j=i({inst:{value:g,getSnapshot:u}}),h=j[0].inst,y=j[1];return t(function(){h.value=g,h.getSnapshot=u,m(h)&&y({inst:h})},[l,g,u]),d(function(){return m(h)&&y({inst:h}),l(function(){m(h)&&y({inst:h})})},[l]),f(g),g}function m(l){var u=l.getSnapshot;l=l.value;try{var g=u();return!o(l,g)}catch{return!0}}function x(l,u){return u()}var N=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?x:c;return M.useSyncExternalStore=s.useSyncExternalStore!==void 0?s.useSyncExternalStore:N,M}var ae;function Be(){return ae||(ae=1,O.exports=$e()),O.exports}var Ve=Be();function He(){return Ve.useSyncExternalStore(Ge,()=>!0,()=>!1)}function Ge(){return()=>{}}var q="Avatar",[We,cs]=Ae(q),[Je,ne]=We(q),oe=r.forwardRef((s,a)=>{const{__scopeAvatar:o,...i}=s,[d,t]=r.useState("idle");return e.jsx(Je,{scope:o,imageLoadingStatus:d,onImageLoadingStatusChange:t,children:e.jsx(b.span,{...i,ref:a})})});oe.displayName=q;var ie="AvatarImage",le=r.forwardRef((s,a)=>{const{__scopeAvatar:o,src:i,onLoadingStatusChange:d=()=>{},...t}=s,f=ne(ie,o),c=Ke(i,t),m=Ie(x=>{d(x),f.onImageLoadingStatusChange(x)});return z(()=>{c!=="idle"&&m(c)},[c,m]),c==="loaded"?e.jsx(b.img,{...t,ref:a,src:i}):null});le.displayName=ie;var de="AvatarFallback",ce=r.forwardRef((s,a)=>{const{__scopeAvatar:o,delayMs:i,...d}=s,t=ne(de,o),[f,c]=r.useState(i===void 0);return r.useEffect(()=>{if(i!==void 0){const m=window.setTimeout(()=>c(!0),i);return()=>window.clearTimeout(m)}},[i]),f&&t.imageLoadingStatus!=="loaded"?e.jsx(b.span,{...d,ref:a}):null});ce.displayName=de;function re(s,a){return s?a?(s.src!==a&&(s.src=a),s.complete&&s.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Ke(s,{referrerPolicy:a,crossOrigin:o}){const i=He(),d=r.useRef(null),t=i?(d.current||(d.current=new window.Image),d.current):null,[f,c]=r.useState(()=>re(t,s));return z(()=>{c(re(t,s))},[t,s]),z(()=>{const m=l=>()=>{c(l)};if(!t)return;const x=m("loaded"),N=m("error");return t.addEventListener("load",x),t.addEventListener("error",N),a&&(t.referrerPolicy=a),typeof o=="string"&&(t.crossOrigin=o),()=>{t.removeEventListener("load",x),t.removeEventListener("error",N)}},[t,o,a]),f}var ue=oe,me=le,fe=ce;const he=r.forwardRef(({className:s,...a},o)=>e.jsx(ue,{ref:o,className:L("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a}));he.displayName=ue.displayName;const xe=r.forwardRef(({className:s,...a},o)=>e.jsx(me,{ref:o,className:L("aspect-square h-full w-full",s),...a}));xe.displayName=me.displayName;const pe=r.forwardRef(({className:s,...a},o)=>e.jsx(fe,{ref:o,className:L("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a}));pe.displayName=fe.displayName;var Ye="Separator",te="horizontal",Qe=["horizontal","vertical"],we=r.forwardRef((s,a)=>{const{decorative:o,orientation:i=te,...d}=s,t=Xe(i)?i:te,c=o?{role:"none"}:{"aria-orientation":t==="vertical"?t:void 0,role:"separator"};return e.jsx(b.div,{"data-orientation":t,...c,...d,ref:a})});we.displayName=Ye;function Xe(s){return Qe.includes(s)}var ge=we;const T=r.forwardRef(({className:s,orientation:a="horizontal",decorative:o=!0,...i},d)=>e.jsx(ge,{ref:d,decorative:o,orientation:a,className:L("shrink-0 bg-border",a==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",s),...i}));T.displayName=ge.displayName;const us=()=>{const{user:s}=Re(),[a,o]=r.useState(null),[i,d]=r.useState(!0),[t,f]=r.useState(!1),[c,m]=r.useState(""),[x,N]=r.useState(""),[l,u]=r.useState(!1),[g,j]=r.useState(!1),[h,y]=r.useState(""),[S,_]=r.useState(""),[$,A]=r.useState(""),[I,ve]=r.useState(!1),[R,je]=r.useState(!1),[k,Ne]=r.useState(!1),[B,V]=r.useState(!1);r.useEffect(()=>{(async()=>{if(s)try{const{data:p,error:G}=await E.from("profiles").select("*").eq("id",s.id).single();if(G)throw G;o(p)}catch(p){console.error("Error fetching user profile:",p)}finally{d(!1)}})()},[s]);const ye=()=>{m(a?.first_name||""),N(a?.last_name||""),f(!0)},Se=async()=>{if(!(!s||!a)){u(!0);try{const{error:n}=await E.from("profiles").update({first_name:c.trim(),last_name:x.trim(),updated_at:new Date().toISOString()}).eq("id",s.id);if(n)throw n;o(p=>p?{...p,first_name:c.trim(),last_name:x.trim(),updated_at:new Date().toISOString()}:null),w.success("Profile updated successfully!"),f(!1)}catch(n){console.error("Error updating profile:",n),w.error("Failed to update profile. Please try again.")}finally{u(!1)}}},Pe=()=>{y(""),_(""),A(""),j(!0)},Ce=async()=>{if(s){if(!h.trim()){w.error("Please enter your current password");return}if(!S.trim()){w.error("Please enter a new password");return}if(S!==$){w.error("New passwords do not match");return}if(S.length<6){w.error("New password must be at least 6 characters long");return}if(h===S){w.error("New password must be different from current password");return}V(!0);try{const{error:n}=await E.auth.signInWithPassword({email:s.email,password:h});if(n){w.error("Current password is incorrect");return}const{error:p}=await E.auth.updateUser({password:S});if(p)throw p;w.success("Password changed successfully!"),j(!1),y(""),_(""),A("")}catch(n){console.error("Error changing password:",n),w.error("Failed to change password. Please try again.")}finally{V(!1)}}};if(i)return e.jsx(U,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading profile..."})})});if(!s)return e.jsx(U,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-muted-foreground",children:"No user found"})})});const Ee=n=>n.split("@")[0].split(".").map(p=>p[0]).join("").toUpperCase(),H=n=>{switch(n){case"admin":return"Administrator";case"instructor":return"Instructor";case"student":return"Student";default:return"User"}},be=n=>{switch(n){case"admin":return"destructive";case"instructor":return"default";case"student":return"secondary";default:return"outline"}};return e.jsxs(U,{children:[e.jsxs("div",{className:"px-6 py-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Profile"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account information and preferences"})]}),e.jsxs(Ue,{children:[e.jsxs(Fe,{children:[e.jsxs(De,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"Profile Information"]}),e.jsx(Oe,{children:"Your personal account details"})]}),e.jsxs(Me,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(he,{className:"h-16 w-16",children:[e.jsx(xe,{src:s.user_metadata?.avatar_url}),e.jsx(pe,{className:"bg-primary/10 text-primary text-lg",children:s.email?Ee(s.email):e.jsx(W,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:a?.first_name&&a?.last_name?`${a.first_name} ${a.last_name}`:s.user_metadata?.full_name||"User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email}),e.jsx(ze,{variant:be(a?.role||"user"),children:H(a?.role||"user")})]})]}),e.jsx(T,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Te,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Role"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:H(a?.role||"user")})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Member Since"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.created_at?new Date(s.created_at).toLocaleDateString():"Unknown"})]})]})]}),e.jsx(T,{}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:ye,children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Edit Profile"]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:Pe,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Change Password"]})]})]})]})]}),e.jsx(J,{open:t,onOpenChange:f,children:e.jsxs(K,{className:"!max-w-md w-[90vw] mx-auto rounded-lg",children:[e.jsxs(Y,{children:[e.jsx(Q,{children:"Edit Profile"}),e.jsx(X,{children:"Update your first name and last name"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"firstName",children:"First Name"}),e.jsx(P,{id:"firstName",value:c,onChange:n=>m(n.target.value),placeholder:"Enter your first name"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"lastName",children:"Last Name"}),e.jsx(P,{id:"lastName",value:x,onChange:n=>N(n.target.value),placeholder:"Enter your last name"})]})]}),e.jsxs(Z,{className:"!flex !flex-row !justify-end gap-2 sm:gap-3",children:[e.jsx(v,{variant:"outline",onClick:()=>f(!1),className:"flex-1 sm:flex-none sm:min-w-[80px]",children:"Cancel"}),e.jsx(v,{onClick:Se,disabled:l,className:"flex-1 sm:flex-none sm:min-w-[80px]",children:l?"Updating...":"Update Profile"})]})]})}),e.jsx(J,{open:g,onOpenChange:j,children:e.jsxs(K,{className:"!max-w-md w-[90vw] mx-auto rounded-lg",children:[e.jsxs(Y,{children:[e.jsx(Q,{children:"Change Password"}),e.jsx(X,{children:"Enter your current password and choose a new password"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"currentPassword",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{id:"currentPassword",type:I?"text":"password",value:h,onChange:n=>y(n.target.value),placeholder:"Enter your current password"}),e.jsx(v,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>ve(!I),children:I?e.jsx(F,{className:"h-4 w-4"}):e.jsx(D,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"newPassword",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{id:"newPassword",type:R?"text":"password",value:S,onChange:n=>_(n.target.value),placeholder:"Enter your new password"}),e.jsx(v,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>je(!R),children:R?e.jsx(F,{className:"h-4 w-4"}):e.jsx(D,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{id:"confirmPassword",type:k?"text":"password",value:$,onChange:n=>A(n.target.value),placeholder:"Confirm your new password"}),e.jsx(v,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>Ne(!k),children:k?e.jsx(F,{className:"h-4 w-4"}):e.jsx(D,{className:"h-4 w-4"})})]})]})]}),e.jsxs(Z,{className:"!flex !flex-row !justify-end gap-2 sm:gap-3",children:[e.jsx(v,{variant:"outline",onClick:()=>j(!1),className:"flex-1 sm:flex-none sm:min-w-[80px]",children:"Cancel"}),e.jsx(v,{onClick:Ce,disabled:B,className:"flex-1 sm:flex-none sm:min-w-[80px]",children:B?"Changing...":"Change Password"})]})]})})]})};export{us as default};
